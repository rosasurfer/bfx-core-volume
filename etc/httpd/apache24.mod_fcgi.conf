#
# VirtualHost configuration for Apache 2.4 with mod_fcgi.
#
<VirtualHost *:80>
    ServerName        bfx.rosasurfer.com
    ServerAlias local.bfx.rosasurfer.com  bankersfx.com  www.bankersfx.com  local.bankersfx.com  local.www.bankersfx.com
    ServerAdmin default

    UseCanonicalName Off

    DocumentRoot "${SITES}/bfx.rosasurfer.com/web"
    CustomLog    "${SITES}/bfx.rosasurfer.com/log/httpd-access.log"  combined
    ErrorLog     "${SITES}/bfx.rosasurfer.com/log/httpd-error.log"

    DirectoryIndex    index.php index.html
    Options           FollowSymLinks
    AddDefaultCharset UTF-8

    <Directory "/">
        # default: no access, .htaccess disabled
        Require all denied
        AllowOverride None
    </Directory>

    <Directory "${SITES}/bfx.rosasurfer.com/web">
        # public access
        Require all granted
    </Directory>

    <FilesMatch "^\.">
        # never serve hidden files
        Require all denied
    </FilesMatch>

    Header set Referrer-Policy "same-origin"

    RewriteEngine On
    RewriteRule   ^/(css|img|js)(/|$)(.*)   -           [L]
    RewriteCond   %{LA-U:REQUEST_FILENAME}  !-d
    RewriteCond   %{LA-U:REQUEST_FILENAME}  !-f
    RewriteRule   ^                         /index.php  [NS,L]

    # FcgidMaxRequestsPerProcess must be <= PHP_FCGI_MAX_REQUESTS in the FcgidWrapper script.
    FcgidMaxRequestsPerProcess 2000

    # FcgidMaxRequestLen (default: 131.072) must be >= post_max_size in php.ini (default: 8MB = 8.388.608).
    FcgidMaxRequestLen 10000000

    <Files "*.php">
        Options      +ExecCGI
        SetHandler   fcgid-script
        FcgidWrapper "${SITES}/bfx.rosasurfer.com/bin/cgi/php-wrapper" .php
    </Files>

    <IfModule mod_suexec.c>
        # With mod_suexec FcgidWrapper must point to a permitted executable (see suexec -V).
        SuexecUserGroup {username} {groupname}
    </IfModule>
    
    # last statement to allow overriding of settings in a custom config
    IncludeOptional "${SITES}/bfx.rosasurfer.com/etc/httpd/.htcustom.mod_fcgi.conf"
</VirtualHost>
